import{bi as te,bx as R,by as Qr,p as J,bz as Vt,bA as b,M as m,P as Ze,a0 as U,bj as lt,b3 as zt,G as Jt,bB as Zr,X as P,bC as en,bD as tn,bE as rn,bF as nn,aE as Xt,bG as sn,bH as on,bI as an,bJ as cn,A as j,S as w,q as ce,R as Yt,bK as Kt,bL as dt,bM as ft,bN as un,bO as ie,C as ln,bP as Tt,B,bQ as Qt,bR as Zt,bS as dn,bT as fn,bU as pn,bV as _n,bW as mn,aq as St,T as we,bX as hn,bY as En,bZ as yt,b_ as et,b$ as It,c0 as tt,a_ as gn,c1 as Tn,bq as Sn,c2 as er,c3 as xe,c4 as wt,c5 as yn,az as In,al as wn,br as Nt,b7 as At,c6 as Nn,c7 as An}from"./academia-Cma1O4UX.js";import{t as On}from"./translations-d0LIz0Lj.js";let re=te,W=chrome.i18n.getUILanguage(),Ee=re.targetLanguage;function z(e,t){const r=lt(e),n=zt(r.value),s=t.split(".");let i=n;for(const o of s)i&&typeof i=="object"&&o in i&&(i=i[o]);return i}function je(){const e=lt(W),r=zt(e.value).language||{},n=Jt(Ee);return n?r[n.value]||n.label:r.en}async function bn(e){re=e,Ee=re.targetLanguage;const t=["page","frame","selection","editable","video","audio"],r=["image"];try{chrome.contextMenus.create({id:R.TRANSLATE_PAGE,title:z(W,"contextMenu.translate").replace("{0}",je()),contexts:t,visible:!0,documentUrlPatterns:["http://*/*","https://*/*"]}),chrome.contextMenus.create({id:R.SHOW_ORIGIN,title:z(W,"contextMenu.showOriginal"),contexts:t,visible:!1,documentUrlPatterns:["http://*/*","https://*/*"]}),chrome.contextMenus.create({id:R.DISABLE_TRANSLATE,title:z(W,"contextMenu.disableSelect"),contexts:t,visible:re.inTextTranslation.enable,documentUrlPatterns:["http://*/*","https://*/*"]}),chrome.contextMenus.create({id:R.SELECT_TRANSLATE,title:z(W,"contextMenu.enableSelect"),contexts:t,visible:!re.inTextTranslation.enable,documentUrlPatterns:["http://*/*","https://*/*"]}),chrome.contextMenus.create({id:R.TRANSLATE_IMAGE,title:`${z(W,"contextMenu.translateAndRestoreImage")}`,contexts:r,visible:!0,documentUrlPatterns:["http://*/*","https://*/*"]})}catch{}}function ke(e){try{re.inTextTranslation.enable!==e.inTextTranslation.enable&&(chrome.contextMenus.update(R.DISABLE_TRANSLATE,{visible:e.inTextTranslation.enable}),chrome.contextMenus.update(R.SELECT_TRANSLATE,{visible:!e.inTextTranslation.enable})),re.targetLanguage!==e.targetLanguage&&(Ee=e.targetLanguage,chrome.contextMenus.update(R.TRANSLATE_PAGE,{title:z(W,"contextMenu.translate").replace("{0}",je())})),re=e}catch{}}function Rn(e){try{if(Ee===e)return;Ee=e,chrome.contextMenus.update(R.TRANSLATE_PAGE,{title:z(W,"contextMenu.translate").replace("{0}",je())})}catch{}}function pt(e){try{chrome.contextMenus.update(R.TRANSLATE_PAGE,{visible:!e}),chrome.contextMenus.update(R.SHOW_ORIGIN,{visible:e})}catch{}}function tr(){try{W=chrome.i18n.getUILanguage(),chrome.contextMenus.update(R.TRANSLATE_PAGE,{title:z(W,"contextMenu.translate").replace("{0}",je())}),chrome.contextMenus.update(R.SHOW_ORIGIN,{title:z(W,"contextMenu.showOriginal")}),chrome.contextMenus.update(R.DISABLE_TRANSLATE,{title:z(W,"contextMenu.disableSelect")}),chrome.contextMenus.update(R.SELECT_TRANSLATE,{title:z(W,"contextMenu.enableSelect")})}catch{}}function Ln(e){var t;return(t=e==null?void 0:e.url)==null?void 0:t.startsWith("chrome-extension://mhjfbmdgcfjbbpaeojofohoefgiehjai/")}chrome.contextMenus.onClicked.addListener(async(e,t)=>{var r;if(Ln(t)&&e.menuItemId===R.TRANSLATE_PAGE){let n="";const s="plugin_rightclickmenu_translate_academia";await Qr(e.frameUrl||"")?n=`${J.fileTranslateRedirectPage}?plugin=anydoc&academia_url=${encodeURIComponent(e.frameUrl||"")}&position=${s}`:n=`${J.fileTranslateRedirectPage}?plugin=anydoc&pdf_url=${encodeURIComponent(e.frameUrl||"")}&position=${s}`,chrome.tabs.create({url:n});return}if(!(!t||!t.id||!((r=t.url)!=null&&r.startsWith("http"))))try{if(e.menuItemId===R.TRANSLATE_PAGE){if(Vt(t.url)){b(t.id,m.TRANSLATE_GOOGLE_DOCS_PAGE,{scene:Ze.CONTEXT_MENU}),U.info("google docs context menu translate page click");return}b(t.id,m.TRANSLATE_PAGE,{scene:Ze.CONTEXT_MENU}),U.info("context menu translate page click")}else e.menuItemId===R.SHOW_ORIGIN?b(t.id,m.SHOW_ORIGIN,{scene:Ze.CONTEXT_MENU}):e.menuItemId===R.DISABLE_TRANSLATE?b(t.id,m.CONTEXT_MENU_TOGGLE_SELECT_TRANSLATE,!1):e.menuItemId===R.SELECT_TRANSLATE?b(t.id,m.CONTEXT_MENU_TOGGLE_SELECT_TRANSLATE,!0):e.menuItemId===R.TRANSLATE_IMAGE&&b(t.id,m.TRANSLATE_IMAGE,{scene:"contextMenu"})}catch{}});chrome.tabs.onActivated.addListener(async e=>{const t=await chrome.tabs.get(e.tabId);if(t.url&&t.url.startsWith("http")&&t.id)try{Ee=await b(t.id,m.GET_PAGE_TRANSLATE_TARGET_LANGUAGE),tr();const r=await b(t.id,m.CHECK_PAGE_TRANSLATED);pt(r.isTranslated)}catch{}});chrome.tabs.onUpdated.addListener((e,t,r)=>{t.status==="complete"&&r.url&&r.url.startsWith("http")&&r.id&&(tr(),pt(!1))});function rr(e,t){return function(){return e.apply(t,arguments)}}const{toString:Cn}=Object.prototype,{getPrototypeOf:_t}=Object,{iterator:qe,toStringTag:nr}=Symbol,$e=(e=>t=>{const r=Cn.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),X=e=>(e=e.toLowerCase(),t=>$e(t)===e),Ve=e=>t=>typeof t===e,{isArray:Te}=Array,ge=Ve("undefined");function Oe(e){return e!==null&&!ge(e)&&e.constructor!==null&&!ge(e.constructor)&&G(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const sr=X("ArrayBuffer");function Pn(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&sr(e.buffer),t}const Un=Ve("string"),G=Ve("function"),ir=Ve("number"),be=e=>e!==null&&typeof e=="object",xn=e=>e===!0||e===!1,De=e=>{if($e(e)!=="object")return!1;const t=_t(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(nr in e)&&!(qe in e)},Mn=e=>{if(!be(e)||Oe(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Fn=X("Date"),Dn=X("File"),Gn=X("Blob"),vn=X("FileList"),kn=e=>be(e)&&G(e.pipe),Bn=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||G(e.append)&&((t=$e(e))==="formdata"||t==="object"&&G(e.toString)&&e.toString()==="[object FormData]"))},Wn=X("URLSearchParams"),[Hn,jn,qn,$n]=["ReadableStream","Request","Response","Headers"].map(X),Vn=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Re(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,s;if(typeof e!="object"&&(e=[e]),Te(e))for(n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else{if(Oe(e))return;const i=r?Object.getOwnPropertyNames(e):Object.keys(e),o=i.length;let a;for(n=0;n<o;n++)a=i[n],t.call(null,e[a],a,e)}}function or(e,t){if(Oe(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n=r.length,s;for(;n-- >0;)if(s=r[n],t===s.toLowerCase())return s;return null}const oe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ar=e=>!ge(e)&&e!==oe;function ot(){const{caseless:e,skipUndefined:t}=ar(this)&&this||{},r={},n=(s,i)=>{const o=e&&or(r,i)||i;De(r[o])&&De(s)?r[o]=ot(r[o],s):De(s)?r[o]=ot({},s):Te(s)?r[o]=s.slice():(!t||!ge(s))&&(r[o]=s)};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&Re(arguments[s],n);return r}const zn=(e,t,r,{allOwnKeys:n}={})=>(Re(t,(s,i)=>{r&&G(s)?e[i]=rr(s,r):e[i]=s},{allOwnKeys:n}),e),Jn=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Xn=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},Yn=(e,t,r,n)=>{let s,i,o;const a={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),i=s.length;i-- >0;)o=s[i],(!n||n(o,e,t))&&!a[o]&&(t[o]=e[o],a[o]=!0);e=r!==!1&&_t(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},Kn=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},Qn=e=>{if(!e)return null;if(Te(e))return e;let t=e.length;if(!ir(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},Zn=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&_t(Uint8Array)),es=(e,t)=>{const n=(e&&e[qe]).call(e);let s;for(;(s=n.next())&&!s.done;){const i=s.value;t.call(e,i[0],i[1])}},ts=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},rs=X("HTMLFormElement"),ns=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,s){return n.toUpperCase()+s}),Ot=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),ss=X("RegExp"),cr=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Re(r,(s,i)=>{let o;(o=t(s,i,e))!==!1&&(n[i]=o||s)}),Object.defineProperties(e,n)},is=e=>{cr(e,(t,r)=>{if(G(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(G(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},os=(e,t)=>{const r={},n=s=>{s.forEach(i=>{r[i]=!0})};return Te(e)?n(e):n(String(e).split(t)),r},as=()=>{},cs=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function us(e){return!!(e&&G(e.append)&&e[nr]==="FormData"&&e[qe])}const ls=e=>{const t=new Array(10),r=(n,s)=>{if(be(n)){if(t.indexOf(n)>=0)return;if(Oe(n))return n;if(!("toJSON"in n)){t[s]=n;const i=Te(n)?[]:{};return Re(n,(o,a)=>{const d=r(o,s+1);!ge(d)&&(i[a]=d)}),t[s]=void 0,i}}return n};return r(e,0)},ds=X("AsyncFunction"),fs=e=>e&&(be(e)||G(e))&&G(e.then)&&G(e.catch),ur=((e,t)=>e?setImmediate:t?((r,n)=>(oe.addEventListener("message",({source:s,data:i})=>{s===oe&&i===r&&n.length&&n.shift()()},!1),s=>{n.push(s),oe.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",G(oe.postMessage)),ps=typeof queueMicrotask<"u"?queueMicrotask.bind(oe):typeof process<"u"&&process.nextTick||ur,_s=e=>e!=null&&G(e[qe]),l={isArray:Te,isArrayBuffer:sr,isBuffer:Oe,isFormData:Bn,isArrayBufferView:Pn,isString:Un,isNumber:ir,isBoolean:xn,isObject:be,isPlainObject:De,isEmptyObject:Mn,isReadableStream:Hn,isRequest:jn,isResponse:qn,isHeaders:$n,isUndefined:ge,isDate:Fn,isFile:Dn,isBlob:Gn,isRegExp:ss,isFunction:G,isStream:kn,isURLSearchParams:Wn,isTypedArray:Zn,isFileList:vn,forEach:Re,merge:ot,extend:zn,trim:Vn,stripBOM:Jn,inherits:Xn,toFlatObject:Yn,kindOf:$e,kindOfTest:X,endsWith:Kn,toArray:Qn,forEachEntry:es,matchAll:ts,isHTMLForm:rs,hasOwnProperty:Ot,hasOwnProp:Ot,reduceDescriptors:cr,freezeMethods:is,toObjectSet:os,toCamelCase:ns,noop:as,toFiniteNumber:cs,findKey:or,global:oe,isContextDefined:ar,isSpecCompliantForm:us,toJSONObject:ls,isAsyncFn:ds,isThenable:fs,setImmediate:ur,asap:ps,isIterable:_s};function S(e,t,r,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}l.inherits(S,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:l.toJSONObject(this.config),code:this.code,status:this.status}}});const lr=S.prototype,dr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{dr[e]={value:e}});Object.defineProperties(S,dr);Object.defineProperty(lr,"isAxiosError",{value:!0});S.from=(e,t,r,n,s,i)=>{const o=Object.create(lr);l.toFlatObject(e,o,function(u){return u!==Error.prototype},c=>c!=="isAxiosError");const a=e&&e.message?e.message:"Error",d=t==null&&e?e.code:t;return S.call(o,a,d,r,n,s),e&&o.cause==null&&Object.defineProperty(o,"cause",{value:e,configurable:!0}),o.name=e&&e.name||"Error",i&&Object.assign(o,i),o};const ms=null;function at(e){return l.isPlainObject(e)||l.isArray(e)}function fr(e){return l.endsWith(e,"[]")?e.slice(0,-2):e}function bt(e,t,r){return e?e.concat(t).map(function(s,i){return s=fr(s),!r&&i?"["+s+"]":s}).join(r?".":""):t}function hs(e){return l.isArray(e)&&!e.some(at)}const Es=l.toFlatObject(l,{},null,function(t){return/^is[A-Z]/.test(t)});function ze(e,t,r){if(!l.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=l.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,_){return!l.isUndefined(_[E])});const n=r.metaTokens,s=r.visitor||u,i=r.dots,o=r.indexes,d=(r.Blob||typeof Blob<"u"&&Blob)&&l.isSpecCompliantForm(t);if(!l.isFunction(s))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if(l.isDate(f))return f.toISOString();if(l.isBoolean(f))return f.toString();if(!d&&l.isBlob(f))throw new S("Blob is not supported. Use a Buffer instead.");return l.isArrayBuffer(f)||l.isTypedArray(f)?d&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,E,_){let T=f;if(f&&!_&&typeof f=="object"){if(l.endsWith(E,"{}"))E=n?E:E.slice(0,-2),f=JSON.stringify(f);else if(l.isArray(f)&&hs(f)||(l.isFileList(f)||l.endsWith(E,"[]"))&&(T=l.toArray(f)))return E=fr(E),T.forEach(function(y,N){!(l.isUndefined(y)||y===null)&&t.append(o===!0?bt([E],N,i):o===null?E:E+"[]",c(y))}),!1}return at(f)?!0:(t.append(bt(_,E,i),c(f)),!1)}const p=[],h=Object.assign(Es,{defaultVisitor:u,convertValue:c,isVisitable:at});function g(f,E){if(!l.isUndefined(f)){if(p.indexOf(f)!==-1)throw Error("Circular reference detected in "+E.join("."));p.push(f),l.forEach(f,function(T,I){(!(l.isUndefined(T)||T===null)&&s.call(t,T,l.isString(I)?I.trim():I,E,h))===!0&&g(T,E?E.concat(I):[I])}),p.pop()}}if(!l.isObject(e))throw new TypeError("data must be an object");return g(e),t}function Rt(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function mt(e,t){this._pairs=[],e&&ze(e,this,t)}const pr=mt.prototype;pr.append=function(t,r){this._pairs.push([t,r])};pr.toString=function(t){const r=t?function(n){return t.call(this,n,Rt)}:Rt;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};function gs(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function _r(e,t,r){if(!t)return e;const n=r&&r.encode||gs;l.isFunction(r)&&(r={serialize:r});const s=r&&r.serialize;let i;if(s?i=s(t,r):i=l.isURLSearchParams(t)?t.toString():new mt(t,r).toString(n),i){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class Lt{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){l.forEach(this.handlers,function(n){n!==null&&t(n)})}}const mr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ts=typeof URLSearchParams<"u"?URLSearchParams:mt,Ss=typeof FormData<"u"?FormData:null,ys=typeof Blob<"u"?Blob:null,Is={isBrowser:!0,classes:{URLSearchParams:Ts,FormData:Ss,Blob:ys},protocols:["http","https","file","blob","url","data"]},ht=typeof window<"u"&&typeof document<"u",ct=typeof navigator=="object"&&navigator||void 0,ws=ht&&(!ct||["ReactNative","NativeScript","NS"].indexOf(ct.product)<0),Ns=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",As=ht&&window.location.href||"http://localhost",Os=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ht,hasStandardBrowserEnv:ws,hasStandardBrowserWebWorkerEnv:Ns,navigator:ct,origin:As},Symbol.toStringTag,{value:"Module"})),M={...Os,...Is};function bs(e,t){return ze(e,new M.classes.URLSearchParams,{visitor:function(r,n,s,i){return M.isNode&&l.isBuffer(r)?(this.append(n,r.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function Rs(e){return l.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Ls(e){const t={},r=Object.keys(e);let n;const s=r.length;let i;for(n=0;n<s;n++)i=r[n],t[i]=e[i];return t}function hr(e){function t(r,n,s,i){let o=r[i++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),d=i>=r.length;return o=!o&&l.isArray(s)?s.length:o,d?(l.hasOwnProp(s,o)?s[o]=[s[o],n]:s[o]=n,!a):((!s[o]||!l.isObject(s[o]))&&(s[o]=[]),t(r,n,s[o],i)&&l.isArray(s[o])&&(s[o]=Ls(s[o])),!a)}if(l.isFormData(e)&&l.isFunction(e.entries)){const r={};return l.forEachEntry(e,(n,s)=>{t(Rs(n),s,r,0)}),r}return null}function Cs(e,t,r){if(l.isString(e))try{return(t||JSON.parse)(e),l.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const Le={transitional:mr,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",s=n.indexOf("application/json")>-1,i=l.isObject(t);if(i&&l.isHTMLForm(t)&&(t=new FormData(t)),l.isFormData(t))return s?JSON.stringify(hr(t)):t;if(l.isArrayBuffer(t)||l.isBuffer(t)||l.isStream(t)||l.isFile(t)||l.isBlob(t)||l.isReadableStream(t))return t;if(l.isArrayBufferView(t))return t.buffer;if(l.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return bs(t,this.formSerializer).toString();if((a=l.isFileList(t))||n.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return ze(a?{"files[]":t}:t,d&&new d,this.formSerializer)}}return i||s?(r.setContentType("application/json",!1),Cs(t)):t}],transformResponse:[function(t){const r=this.transitional||Le.transitional,n=r&&r.forcedJSONParsing,s=this.responseType==="json";if(l.isResponse(t)||l.isReadableStream(t))return t;if(t&&l.isString(t)&&(n&&!this.responseType||s)){const o=!(r&&r.silentJSONParsing)&&s;try{return JSON.parse(t,this.parseReviver)}catch(a){if(o)throw a.name==="SyntaxError"?S.from(a,S.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:M.classes.FormData,Blob:M.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};l.forEach(["delete","get","head","post","put","patch"],e=>{Le.headers[e]={}});const Ps=l.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Us=e=>{const t={};let r,n,s;return e&&e.split(`
`).forEach(function(o){s=o.indexOf(":"),r=o.substring(0,s).trim().toLowerCase(),n=o.substring(s+1).trim(),!(!r||t[r]&&Ps[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},Ct=Symbol("internals");function Ne(e){return e&&String(e).trim().toLowerCase()}function Ge(e){return e===!1||e==null?e:l.isArray(e)?e.map(Ge):String(e)}function xs(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const Ms=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function rt(e,t,r,n,s){if(l.isFunction(n))return n.call(this,t,r);if(s&&(t=r),!!l.isString(t)){if(l.isString(n))return t.indexOf(n)!==-1;if(l.isRegExp(n))return n.test(t)}}function Fs(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function Ds(e,t){const r=l.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(s,i,o){return this[n].call(this,t,s,i,o)},configurable:!0})})}let v=class{constructor(t){t&&this.set(t)}set(t,r,n){const s=this;function i(a,d,c){const u=Ne(d);if(!u)throw new Error("header name must be a non-empty string");const p=l.findKey(s,u);(!p||s[p]===void 0||c===!0||c===void 0&&s[p]!==!1)&&(s[p||d]=Ge(a))}const o=(a,d)=>l.forEach(a,(c,u)=>i(c,u,d));if(l.isPlainObject(t)||t instanceof this.constructor)o(t,r);else if(l.isString(t)&&(t=t.trim())&&!Ms(t))o(Us(t),r);else if(l.isObject(t)&&l.isIterable(t)){let a={},d,c;for(const u of t){if(!l.isArray(u))throw TypeError("Object iterator must return a key-value pair");a[c=u[0]]=(d=a[c])?l.isArray(d)?[...d,u[1]]:[d,u[1]]:u[1]}o(a,r)}else t!=null&&i(r,t,n);return this}get(t,r){if(t=Ne(t),t){const n=l.findKey(this,t);if(n){const s=this[n];if(!r)return s;if(r===!0)return xs(s);if(l.isFunction(r))return r.call(this,s,n);if(l.isRegExp(r))return r.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Ne(t),t){const n=l.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||rt(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let s=!1;function i(o){if(o=Ne(o),o){const a=l.findKey(n,o);a&&(!r||rt(n,n[a],a,r))&&(delete n[a],s=!0)}}return l.isArray(t)?t.forEach(i):i(t),s}clear(t){const r=Object.keys(this);let n=r.length,s=!1;for(;n--;){const i=r[n];(!t||rt(this,this[i],i,t,!0))&&(delete this[i],s=!0)}return s}normalize(t){const r=this,n={};return l.forEach(this,(s,i)=>{const o=l.findKey(n,i);if(o){r[o]=Ge(s),delete r[i];return}const a=t?Fs(i):String(i).trim();a!==i&&delete r[i],r[a]=Ge(s),n[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return l.forEach(this,(n,s)=>{n!=null&&n!==!1&&(r[s]=t&&l.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(s=>n.set(s)),n}static accessor(t){const n=(this[Ct]=this[Ct]={accessors:{}}).accessors,s=this.prototype;function i(o){const a=Ne(o);n[a]||(Ds(s,o),n[a]=!0)}return l.isArray(t)?t.forEach(i):i(t),this}};v.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);l.reduceDescriptors(v.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});l.freezeMethods(v);function nt(e,t){const r=this||Le,n=t||r,s=v.from(n.headers);let i=n.data;return l.forEach(e,function(a){i=a.call(r,i,s.normalize(),t?t.status:void 0)}),s.normalize(),i}function Er(e){return!!(e&&e.__CANCEL__)}function Se(e,t,r){S.call(this,e??"canceled",S.ERR_CANCELED,t,r),this.name="CanceledError"}l.inherits(Se,S,{__CANCEL__:!0});function gr(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new S("Request failed with status code "+r.status,[S.ERR_BAD_REQUEST,S.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Gs(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function vs(e,t){e=e||10;const r=new Array(e),n=new Array(e);let s=0,i=0,o;return t=t!==void 0?t:1e3,function(d){const c=Date.now(),u=n[i];o||(o=c),r[s]=d,n[s]=c;let p=i,h=0;for(;p!==s;)h+=r[p++],p=p%e;if(s=(s+1)%e,s===i&&(i=(i+1)%e),c-o<t)return;const g=u&&c-u;return g?Math.round(h*1e3/g):void 0}}function ks(e,t){let r=0,n=1e3/t,s,i;const o=(c,u=Date.now())=>{r=u,s=null,i&&(clearTimeout(i),i=null),e(...c)};return[(...c)=>{const u=Date.now(),p=u-r;p>=n?o(c,u):(s=c,i||(i=setTimeout(()=>{i=null,o(s)},n-p)))},()=>s&&o(s)]}const Be=(e,t,r=3)=>{let n=0;const s=vs(50,250);return ks(i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,d=o-n,c=s(d),u=o<=a;n=o;const p={loaded:o,total:a,progress:a?o/a:void 0,bytes:d,rate:c||void 0,estimated:c&&a&&u?(a-o)/c:void 0,event:i,lengthComputable:a!=null,[t?"download":"upload"]:!0};e(p)},r)},Pt=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},Ut=e=>(...t)=>l.asap(()=>e(...t)),Bs=M.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,M.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(M.origin),M.navigator&&/(msie|trident)/i.test(M.navigator.userAgent)):()=>!0,Ws=M.hasStandardBrowserEnv?{write(e,t,r,n,s,i,o){if(typeof document>"u")return;const a=[`${e}=${encodeURIComponent(t)}`];l.isNumber(r)&&a.push(`expires=${new Date(r).toUTCString()}`),l.isString(n)&&a.push(`path=${n}`),l.isString(s)&&a.push(`domain=${s}`),i===!0&&a.push("secure"),l.isString(o)&&a.push(`SameSite=${o}`),document.cookie=a.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Hs(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function js(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function Tr(e,t,r){let n=!Hs(t);return e&&(n||r==!1)?js(e,t):t}const xt=e=>e instanceof v?{...e}:e;function ue(e,t){t=t||{};const r={};function n(c,u,p,h){return l.isPlainObject(c)&&l.isPlainObject(u)?l.merge.call({caseless:h},c,u):l.isPlainObject(u)?l.merge({},u):l.isArray(u)?u.slice():u}function s(c,u,p,h){if(l.isUndefined(u)){if(!l.isUndefined(c))return n(void 0,c,p,h)}else return n(c,u,p,h)}function i(c,u){if(!l.isUndefined(u))return n(void 0,u)}function o(c,u){if(l.isUndefined(u)){if(!l.isUndefined(c))return n(void 0,c)}else return n(void 0,u)}function a(c,u,p){if(p in t)return n(c,u);if(p in e)return n(void 0,c)}const d={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,u,p)=>s(xt(c),xt(u),p,!0)};return l.forEach(Object.keys({...e,...t}),function(u){const p=d[u]||s,h=p(e[u],t[u],u);l.isUndefined(h)&&p!==a||(r[u]=h)}),r}const Sr=e=>{const t=ue({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:i,headers:o,auth:a}=t;if(t.headers=o=v.from(o),t.url=_r(Tr(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),l.isFormData(r)){if(M.hasStandardBrowserEnv||M.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(l.isFunction(r.getHeaders)){const d=r.getHeaders(),c=["content-type","content-length"];Object.entries(d).forEach(([u,p])=>{c.includes(u.toLowerCase())&&o.set(u,p)})}}if(M.hasStandardBrowserEnv&&(n&&l.isFunction(n)&&(n=n(t)),n||n!==!1&&Bs(t.url))){const d=s&&i&&Ws.read(i);d&&o.set(s,d)}return t},qs=typeof XMLHttpRequest<"u",$s=qs&&function(e){return new Promise(function(r,n){const s=Sr(e);let i=s.data;const o=v.from(s.headers).normalize();let{responseType:a,onUploadProgress:d,onDownloadProgress:c}=s,u,p,h,g,f;function E(){g&&g(),f&&f(),s.cancelToken&&s.cancelToken.unsubscribe(u),s.signal&&s.signal.removeEventListener("abort",u)}let _=new XMLHttpRequest;_.open(s.method.toUpperCase(),s.url,!0),_.timeout=s.timeout;function T(){if(!_)return;const y=v.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),A={data:!a||a==="text"||a==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:y,config:e,request:_};gr(function(O){r(O),E()},function(O){n(O),E()},A),_=null}"onloadend"in _?_.onloadend=T:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(T)},_.onabort=function(){_&&(n(new S("Request aborted",S.ECONNABORTED,e,_)),_=null)},_.onerror=function(N){const A=N&&N.message?N.message:"Network Error",F=new S(A,S.ERR_NETWORK,e,_);F.event=N||null,n(F),_=null},_.ontimeout=function(){let N=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const A=s.transitional||mr;s.timeoutErrorMessage&&(N=s.timeoutErrorMessage),n(new S(N,A.clarifyTimeoutError?S.ETIMEDOUT:S.ECONNABORTED,e,_)),_=null},i===void 0&&o.setContentType(null),"setRequestHeader"in _&&l.forEach(o.toJSON(),function(N,A){_.setRequestHeader(A,N)}),l.isUndefined(s.withCredentials)||(_.withCredentials=!!s.withCredentials),a&&a!=="json"&&(_.responseType=s.responseType),c&&([h,f]=Be(c,!0),_.addEventListener("progress",h)),d&&_.upload&&([p,g]=Be(d),_.upload.addEventListener("progress",p),_.upload.addEventListener("loadend",g)),(s.cancelToken||s.signal)&&(u=y=>{_&&(n(!y||y.type?new Se(null,e,_):y),_.abort(),_=null)},s.cancelToken&&s.cancelToken.subscribe(u),s.signal&&(s.signal.aborted?u():s.signal.addEventListener("abort",u)));const I=Gs(s.url);if(I&&M.protocols.indexOf(I)===-1){n(new S("Unsupported protocol "+I+":",S.ERR_BAD_REQUEST,e));return}_.send(i||null)})},Vs=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,s;const i=function(c){if(!s){s=!0,a();const u=c instanceof Error?c:this.reason;n.abort(u instanceof S?u:new Se(u instanceof Error?u.message:u))}};let o=t&&setTimeout(()=>{o=null,i(new S(`timeout ${t} of ms exceeded`,S.ETIMEDOUT))},t);const a=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),e=null)};e.forEach(c=>c.addEventListener("abort",i));const{signal:d}=n;return d.unsubscribe=()=>l.asap(a),d}},zs=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,s;for(;n<r;)s=n+t,yield e.slice(n,s),n=s},Js=async function*(e,t){for await(const r of Xs(e))yield*zs(r,t)},Xs=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},Mt=(e,t,r,n)=>{const s=Js(e,t);let i=0,o,a=d=>{o||(o=!0,n&&n(d))};return new ReadableStream({async pull(d){try{const{done:c,value:u}=await s.next();if(c){a(),d.close();return}let p=u.byteLength;if(r){let h=i+=p;r(h)}d.enqueue(new Uint8Array(u))}catch(c){throw a(c),c}},cancel(d){return a(d),s.return()}},{highWaterMark:2})},Ft=64*1024,{isFunction:Me}=l,Ys=(({Request:e,Response:t})=>({Request:e,Response:t}))(l.global),{ReadableStream:Dt,TextEncoder:Gt}=l.global,vt=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Ks=e=>{e=l.merge.call({skipUndefined:!0},Ys,e);const{fetch:t,Request:r,Response:n}=e,s=t?Me(t):typeof fetch=="function",i=Me(r),o=Me(n);if(!s)return!1;const a=s&&Me(Dt),d=s&&(typeof Gt=="function"?(f=>E=>f.encode(E))(new Gt):async f=>new Uint8Array(await new r(f).arrayBuffer())),c=i&&a&&vt(()=>{let f=!1;const E=new r(M.origin,{body:new Dt,method:"POST",get duplex(){return f=!0,"half"}}).headers.has("Content-Type");return f&&!E}),u=o&&a&&vt(()=>l.isReadableStream(new n("").body)),p={stream:u&&(f=>f.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!p[f]&&(p[f]=(E,_)=>{let T=E&&E[f];if(T)return T.call(E);throw new S(`Response type '${f}' is not supported`,S.ERR_NOT_SUPPORT,_)})});const h=async f=>{if(f==null)return 0;if(l.isBlob(f))return f.size;if(l.isSpecCompliantForm(f))return(await new r(M.origin,{method:"POST",body:f}).arrayBuffer()).byteLength;if(l.isArrayBufferView(f)||l.isArrayBuffer(f))return f.byteLength;if(l.isURLSearchParams(f)&&(f=f+""),l.isString(f))return(await d(f)).byteLength},g=async(f,E)=>{const _=l.toFiniteNumber(f.getContentLength());return _??h(E)};return async f=>{let{url:E,method:_,data:T,signal:I,cancelToken:y,timeout:N,onDownloadProgress:A,onUploadProgress:F,responseType:O,headers:de,withCredentials:q="same-origin",fetchOptions:ne}=Sr(f),Z=t||fetch;O=O?(O+"").toLowerCase():"text";let $=Vs([I,y&&y.toAbortSignal()],N),V=null;const k=$&&$.unsubscribe&&(()=>{$.unsubscribe()});let se;try{if(F&&c&&_!=="get"&&_!=="head"&&(se=await g(de,T))!==0){let H=new r(E,{method:"POST",body:T,duplex:"half"}),K;if(l.isFormData(T)&&(K=H.headers.get("content-type"))&&de.setContentType(K),H.body){const[Ie,pe]=Pt(se,Be(Ut(F)));T=Mt(H.body,Ft,Ie,pe)}}l.isString(q)||(q=q?"include":"omit");const D=i&&"credentials"in r.prototype,Ce={...ne,signal:$,method:_.toUpperCase(),headers:de.normalize().toJSON(),body:T,duplex:"half",credentials:D?q:void 0};V=i&&new r(E,Ce);let Y=await(i?Z(V,ne):Z(E,Ce));const fe=u&&(O==="stream"||O==="response");if(u&&(A||fe&&k)){const H={};["status","statusText","headers"].forEach(Pe=>{H[Pe]=Y[Pe]});const K=l.toFiniteNumber(Y.headers.get("content-length")),[Ie,pe]=A&&Pt(K,Be(Ut(A),!0))||[];Y=new n(Mt(Y.body,Ft,Ie,()=>{pe&&pe(),k&&k()}),H)}O=O||"text";let ye=await p[l.findKey(p,O)||"text"](Y,f);return!fe&&k&&k(),await new Promise((H,K)=>{gr(H,K,{data:ye,headers:v.from(Y.headers),status:Y.status,statusText:Y.statusText,config:f,request:V})})}catch(D){throw k&&k(),D&&D.name==="TypeError"&&/Load failed|fetch/i.test(D.message)?Object.assign(new S("Network Error",S.ERR_NETWORK,f,V),{cause:D.cause||D}):S.from(D,D&&D.code,f,V)}}},Qs=new Map,yr=e=>{let t=e&&e.env||{};const{fetch:r,Request:n,Response:s}=t,i=[n,s,r];let o=i.length,a=o,d,c,u=Qs;for(;a--;)d=i[a],c=u.get(d),c===void 0&&u.set(d,c=a?new Map:Ks(t)),u=c;return c};yr();const Et={http:ms,xhr:$s,fetch:{get:yr}};l.forEach(Et,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const kt=e=>`- ${e}`,Zs=e=>l.isFunction(e)||e===null||e===!1;function ei(e,t){e=l.isArray(e)?e:[e];const{length:r}=e;let n,s;const i={};for(let o=0;o<r;o++){n=e[o];let a;if(s=n,!Zs(n)&&(s=Et[(a=String(n)).toLowerCase()],s===void 0))throw new S(`Unknown adapter '${a}'`);if(s&&(l.isFunction(s)||(s=s.get(t))))break;i[a||"#"+o]=s}if(!s){const o=Object.entries(i).map(([d,c])=>`adapter ${d} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=r?o.length>1?`since :
`+o.map(kt).join(`
`):" "+kt(o[0]):"as no adapter specified";throw new S("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s}const Ir={getAdapter:ei,adapters:Et};function st(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Se(null,e)}function Bt(e){return st(e),e.headers=v.from(e.headers),e.data=nt.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Ir.getAdapter(e.adapter||Le.adapter,e)(e).then(function(n){return st(e),n.data=nt.call(e,e.transformResponse,n),n.headers=v.from(n.headers),n},function(n){return Er(n)||(st(e),n&&n.response&&(n.response.data=nt.call(e,e.transformResponse,n.response),n.response.headers=v.from(n.response.headers))),Promise.reject(n)})}const wr="1.13.2",Je={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Je[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Wt={};Je.transitional=function(t,r,n){function s(i,o){return"[Axios v"+wr+"] Transitional option '"+i+"'"+o+(n?". "+n:"")}return(i,o,a)=>{if(t===!1)throw new S(s(o," has been removed"+(r?" in "+r:"")),S.ERR_DEPRECATED);return r&&!Wt[o]&&(Wt[o]=!0,console.warn(s(o," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(i,o,a):!0}};Je.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function ti(e,t,r){if(typeof e!="object")throw new S("options must be an object",S.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let s=n.length;for(;s-- >0;){const i=n[s],o=t[i];if(o){const a=e[i],d=a===void 0||o(a,i,e);if(d!==!0)throw new S("option "+i+" must be "+d,S.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new S("Unknown option "+i,S.ERR_BAD_OPTION)}}const ve={assertOptions:ti,validators:Je},Q=ve.validators;let ae=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Lt,response:new Lt}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=ue(this.defaults,r);const{transitional:n,paramsSerializer:s,headers:i}=r;n!==void 0&&ve.assertOptions(n,{silentJSONParsing:Q.transitional(Q.boolean),forcedJSONParsing:Q.transitional(Q.boolean),clarifyTimeoutError:Q.transitional(Q.boolean)},!1),s!=null&&(l.isFunction(s)?r.paramsSerializer={serialize:s}:ve.assertOptions(s,{encode:Q.function,serialize:Q.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),ve.assertOptions(r,{baseUrl:Q.spelling("baseURL"),withXsrfToken:Q.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o=i&&l.merge(i.common,i[r.method]);i&&l.forEach(["delete","get","head","post","put","patch","common"],f=>{delete i[f]}),r.headers=v.concat(o,i);const a=[];let d=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(r)===!1||(d=d&&E.synchronous,a.unshift(E.fulfilled,E.rejected))});const c=[];this.interceptors.response.forEach(function(E){c.push(E.fulfilled,E.rejected)});let u,p=0,h;if(!d){const f=[Bt.bind(this),void 0];for(f.unshift(...a),f.push(...c),h=f.length,u=Promise.resolve(r);p<h;)u=u.then(f[p++],f[p++]);return u}h=a.length;let g=r;for(;p<h;){const f=a[p++],E=a[p++];try{g=f(g)}catch(_){E.call(this,_);break}}try{u=Bt.call(this,g)}catch(f){return Promise.reject(f)}for(p=0,h=c.length;p<h;)u=u.then(c[p++],c[p++]);return u}getUri(t){t=ue(this.defaults,t);const r=Tr(t.baseURL,t.url,t.allowAbsoluteUrls);return _r(r,t.params,t.paramsSerializer)}};l.forEach(["delete","get","head","options"],function(t){ae.prototype[t]=function(r,n){return this.request(ue(n||{},{method:t,url:r,data:(n||{}).data}))}});l.forEach(["post","put","patch"],function(t){function r(n){return function(i,o,a){return this.request(ue(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}ae.prototype[t]=r(),ae.prototype[t+"Form"]=r(!0)});let ri=class Nr{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(i){r=i});const n=this;this.promise.then(s=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](s);n._listeners=null}),this.promise.then=s=>{let i;const o=new Promise(a=>{n.subscribe(a),i=a}).then(s);return o.cancel=function(){n.unsubscribe(i)},o},t(function(i,o,a){n.reason||(n.reason=new Se(i,o,a),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new Nr(function(s){t=s}),cancel:t}}};function ni(e){return function(r){return e.apply(null,r)}}function si(e){return l.isObject(e)&&e.isAxiosError===!0}const ut={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(ut).forEach(([e,t])=>{ut[t]=e});function Ar(e){const t=new ae(e),r=rr(ae.prototype.request,t);return l.extend(r,ae.prototype,t,{allOwnKeys:!0}),l.extend(r,t,null,{allOwnKeys:!0}),r.create=function(s){return Ar(ue(e,s))},r}const L=Ar(Le);L.Axios=ae;L.CanceledError=Se;L.CancelToken=ri;L.isCancel=Er;L.VERSION=wr;L.toFormData=ze;L.AxiosError=S;L.Cancel=L.CanceledError;L.all=function(t){return Promise.all(t)};L.spread=ni;L.isAxiosError=si;L.mergeConfig=ue;L.AxiosHeaders=v;L.formToJSON=e=>hr(l.isHTMLForm(e)?new FormData(e):e);L.getAdapter=Ir.getAdapter;L.HttpStatusCode=ut;L.default=L;const{Axios:Yi,AxiosError:Ki,CanceledError:Qi,isCancel:Zi,CancelToken:eo,VERSION:to,all:ro,Cancel:no,isAxiosError:so,spread:io,toFormData:oo,AxiosHeaders:ao,HttpStatusCode:co,formToJSON:uo,getAdapter:lo,mergeConfig:fo}=L;let me={ANDROID:"android",WEB:"web",PC:"pc"},C={ORIGIN_ITEM_INFO:"origin_item_info",TRIAL_ITEM_INFO:"trial_item_info",DISCOUNT_ORIGIN_ITEM_INFO:"discount_origin_item_info",DISCOUNT_TRIAL_ITEM_INFO:"discount_trial_item_info",ONE_TIME_ORIGIN_ITEM_INFO:"one_time_origin_item_info",ONE_TIME_DISCOUNT_ITEM_INFO:"one_time_discount_item_info"},Or=Object.values(C),Ae={TRIAL_ITEM_INFO:"trail",ORIGIN_ITEM_INFO:"origin",ONE_TIME_ORIGIN_ITEM_INFO:"one_time_origin",DISCOUNT_TRIAL_ITEM_INFO:"discount_trail",DISCOUNT_ORIGIN_ITEM_INFO:"discount_origin",ONE_TIME_DISCOUNT_ITEM_INFO:"one_time_discount"},Fe={WINDOW_DATA_INIT:"WINDOW_DATA_INIT",WINDOW_CHANGE:"WINDOW_CHANGE",PAYMENT_CHANGE:"PAYMENT_CHANGE",LOGIN_STATUS_CHANGE:"LOGIN_STATUS_CHANGE"};function le(e){return e&&e!=null&&Object.keys(e).length!==0}let Ht=({sku:h,paymentItem:r={}})=>{if(!h||!le(h))throw new Error("singleSkuDataFormat: sku is required");var{support_local_currency:r,default_price_display:n,default_currency:s,default_currency_symbol:i,default_currency_country:o,default_amount:a,default_avg_price:d,default_avg_price_amount:c,default_try_price_display:u,default_discount_price_display:p}=r,{id:h,name:g,privilege_code:f,sku_type:E,sku_id:_,sku_name:T,period:I,period_unit:y,price_unit:N,currency:A,ext_currency:F,currency_symbol:O,ext_currency_symbol:de,currency_country:q,ext_currency_country:ne,price_display:Z,ext_price_display:$,try_price_display:V,ext_try_price_display:k,discount_price_display:se,ext_discount_price_display:D,avg_price:Ce,ext_avg_price:Y,avg_price_amount:fe,ext_avg_price_amount:ye,amount:H,ext_amount:K,avg_price_amount_num:Ie,ext_avg_price_amount_num:pe,trial_period:Pe,trial_period_unit:Pr,try_limit:Ur,first_exp_info:xr={},item_content:Mr,permit_text:Fr,originShop:Dr,skuFlag:Ue,pay_methods:Gr,sub_long_tip:vr,description:kr,ext_description:Br,lang_period_unit:Wr,item_permit_desc:Hr,can_share:jr,share_count:qr,can_give:$r,give_content_map:Vr,give_contents:zr,give_unit:Jr,is_gift_card:Xr,is_edu:Yr,item_label_text:Kr}=h;let Ke="",Qe="";return Z=r?Z:n||$,n=r?fe:c||ye,$=N,fe=r?H:a||K,ye=r?Ie:c||pe,N=r?A:s||F,H=r?O:i||de,a=r?q:o||ne,K=r?Ce:d||Y,[Ae.DISCOUNT_ORIGIN_ITEM_INFO,Ae.ONE_TIME_DISCOUNT_ITEM_INFO].includes(Ue)&&(Ke=r?se:p||D),[Ae.TRIAL_ITEM_INFO].includes(Ue)&&(Qe=r?V:u||k),[Ae.DISCOUNT_TRIAL_ITEM_INFO].includes(Ue)&&(Ke=r?se:p||D,Qe=r?V:u||k),{skuFlag:Ue,id:h,name:g,privilege_code:f,sku_type:E,sku_id:_,sku_name:T,period:I,period_unit:y,price_unit:$,currency:N,currency_symbol:H,currency_country:a,trial_period:Pe,trial_period_unit:Pr,try_limit:Ur,amount:fe,avg_amount:ye,price_display:Z,try_price_display:Qe,discount_price_display:Ke,avg_price_display:n,avg_price:K,item_content:Mr,permit_text:Fr,pay_methods:Gr,sub_long_tip:vr,description:kr,ext_description:Br,lang_period_unit:Wr,item_permit_desc:Hr,can_share:jr,share_count:qr,can_give:$r,give_content_map:Vr,give_contents:zr,give_unit:Jr,is_gift_card:Xr,is_edu:Yr,first_exp_info:xr,item_label_text:Kr,originShop:Dr}},ii=(e,t)=>{if(!e||!le(e))throw new Error("getOriginShop: shopItem 参数类型错误");switch(t){case C.ORIGIN_ITEM_INFO:case C.TRIAL_ITEM_INFO:case C.ONE_TIME_ORIGIN_ITEM_INFO:return{};case C.DISCOUNT_ORIGIN_ITEM_INFO:case C.DISCOUNT_TRIAL_ITEM_INFO:return e[C.ORIGIN_ITEM_INFO];case C.ONE_TIME_DISCOUNT_ITEM_INFO:return e[C.ONE_TIME_ORIGIN_ITEM_INFO]}},br=e=>{if(!e||!Array.isArray(e))throw new Error("shopItemsDataRestruct: list 参数类型错误");if(!e.length)return[];let t=[];return e.forEach(r=>{let n={},s=[],{add_buy_info:i=[],privilege_name:o,tried_count:a,...d}=r;i&&Array.isArray(i)&&i.length&&(s=br(i)),Object.keys(d).forEach(c=>{if(Or.includes(c)&&d[c]){let u=d[c],p={},h=ii(d,c)||{};((u||{}).pay_methods||[]).forEach(g=>{p[g.payment_type]={privilege_name:o,tried_count:a,...Ht({sku:u,paymentItem:g}),skuFlag:Ae[c.toUpperCase()],originShop:le(h)?Ht({sku:h,paymentItem:(h.pay_methods||[]).find(({payment_type:f})=>f===g.payment_type)||{}}):{},add_buy_info:s}}),n[c]=p}}),t.push(n)}),t};function Xe({shopList:e,currentSelectPayment:t,platform:r,permitTrialList:n=[],permitTrialCount:s=0}={}){var i=[];for(let h=0,g=e.length;h<g;h++){let f=e[h];(f[C.DISCOUNT_TRIAL_ITEM_INFO]||f[C.TRIAL_ITEM_INFO])&&(Array.isArray(n)&&n.length||0<s)&&(o=[{val:f[C.DISCOUNT_TRIAL_ITEM_INFO],key:C.DISCOUNT_TRIAL_ITEM_INFO},{val:f[C.TRIAL_ITEM_INFO],key:C.TRIAL_ITEM_INFO}].filter(_=>le(_.val))).length&&o.forEach(_=>{var{privilege_code:T,try_limit:I}=Object.keys(_.val)[0];let y=!0;if([me.WEB,me.PC].includes(r)){T=T?T.split(","):[];let N=n.map(({permit_name:A})=>A);y=T.some(A=>{var F;return N.includes(A)?!(F=n.find(({permit_name:O})=>O===A))||F.num<1:!N.includes(A)})}else[me.ANDROID].includes(r)&&(y=!!(I&&s<I));y||delete f[_.key]});var{discount_trial_item_info:o,trial_item_info:u,discount_origin_item_info:p,origin_item_info:a,one_time_discount_item_info:d,one_time_origin_item_info:c}=f,u=[o,u,p,a,d,c].filter(_=>le(_)).find(_=>_[t]),{add_buy_info:p=[]}=u?u[t]:{};let E=[];Array.isArray(p)&&p.length&&(E=Xe({shopList:p,currentSelectPayment:t,permitTrialList:n,platform:r,permitTrialCount:s})),u&&i.push({...u[t],add_buy_info:E})}return i}function oi({windowItem:e,permitTrialList:t=[],platform:r=me.WEB,currentSelectPayment:n,permitTrialCount:s=0}={}){let{shop_items:i,id:o,...a}=e||{};if(!Array.isArray(i)||!i.length)throw new Error("shop_items is not array or empty array");let d=((e==null?void 0:e.payment_infos)||[]).map(({payment_type:c})=>c);return i.length&&i.forEach(c=>{Object.keys(c).forEach(u=>{var p,h;Or.includes(u)&&(c[u]&&le(c[u])?[C.DISCOUNT_TRIAL_ITEM_INFO,C.DISCOUNT_ORIGIN_ITEM_INFO,C.ONE_TIME_DISCOUNT_ITEM_INFO].includes(u)?(p=Math.floor(new Date().getTime()/1e3),h=c[u].discount_time_end,h&&h<p&&delete c[u]):c[u].pay_methods&&c[u].pay_methods.length&&(h=c[u].pay_methods.filter(({payment_type:g})=>d.includes(g))).length?c[u].pay_methods=h:delete c[u]:delete c[u])})}),e=br(i),{id:o,shop_items:Xe({shopList:e,currentSelectPayment:n,permitTrialList:t,platform:r,permitTrialCount:s}),paymentEnumShopList:e,...a}}function ai(e){let{windowList:t,platform:r,permitTrialList:n,currentSelectPayment:s}=e||{};return JSON.parse(JSON.stringify(t)).map((i,o)=>(o=o===0?s:i.default_payment,oi({windowItem:i,permitTrialList:n,platform:r,currentSelectPayment:o})))}function ci(s){var{windowList:s,windowIndex:i,currentSelectPayment:t,platform:r,shopIndex:n}=s,{paymentEnumShopList:s=[]}=s[i]||{},i=Xe({shopList:s,currentSelectPayment:t,platform:r});return{shopIndex:n,currentShop:i[n],currentWindowShopList:i,currentSelectPayment:t}}function ui(o){var{windowList:o,windowIndex:i,currentSelectPayment:t,platform:r,permitTrialList:n,permitTrialCount:s}=o,{paymentEnumShopList:o=[]}=o[i]||{},i=Xe({shopList:o,currentSelectPayment:t,platform:r,permitTrialList:n,permitTrialCount:s}),o=i[shopIndex];return{shopIndex,currentShop:o,currentWindowShopList:i,currentSelectPayment:t}}function jt(i){var{windowList:i,windowIndex:t,shopIndex:r,platform:n,currentSelectPayment:s}=i||{},i=i[t]||{},{id:o,payment_infos:f,style_content:a,style_tag:d,pay_page_style_content:c,pay_retain_shop_id:u,retain_pay_config:p,coupon_shop_ids:h,shop_items:g}=i,f=f.map(({payment_type:_})=>_),E=g[r]||{};return{windowIndex:t,currentWindow:i,currentWindowId:o,currentWindowPaymentList:f,currentWindowStyle:n===me.WEB?c:a,currentWindowStyleTag:d,currentWindowPayRetainShopId:u,currentWindowPayRetainConfig:p,currentWindowCouponShopIds:h,currentWindowShopList:g,shopIndex:r,currentShop:E,currentSelectPayment:s}}function li(e,{windowList:t=[],windowIndex:r=0,permitTrialList:n=[],permitTrialCount:s=0,shopIndex:i=0,platform:o=me.WEB,currentSelectPayment:a=""}){var p;if(!Array.isArray(t)||!t.length)throw new Error("windowList is is not array");if(Number(r)>t.length-1)throw new Error("windowIndex is more than windowList length");var d=a||((p=t[r])==null?void 0:p.default_payment);switch(e){case Fe.WINDOW_DATA_INIT:var c={windowList:t,platform:o,permitTrialList:n,permitTrialCount:s,currentSelectPayment:d};try{var u=ai(c);return{afterFormatWindowList:u,...jt({windowList:u,windowIndex:r,shopIndex:i,platform:o,currentSelectPayment:d})}}catch(h){console.log("初始化橱窗数据: ACTION_NAME.WINDOW_DATA_INIT error",h)}case Fe.WINDOW_CHANGE:try{return jt({windowList:t,windowIndex:r,shopIndex:i,platform:o,currentSelectPayment:d})}catch(h){console.log("切换橱窗: ACTION_NAME.WINDOW_CHANGE error",h)}case Fe.PAYMENT_CHANGE:try{return ci({windowList:t,windowIndex:r,currentSelectPayment:d,platform:o,shopIndex:i})}catch(h){console.log("切换支付方式: ACTION_NAME.PAYMENT_CHANGE error",h)}case Fe.LOGIN_STATUS_CHANGE:try{return ui({windowList:t,windowIndex:r,currentSelectPayment:d,platform:o,permitTrialList:n,permitTrialCount:s,shopIndex:0})}catch(h){console.log("切换登录态: ACTION_NAME.LOGIN_STATUS_CHANGE error",h)}}}let We={TEST:"test",PROD:"production"},qt=Object.values(We),he={WEB:"web",ANDROID:"android"},$t=Object.values(he),di={WPS_OFFICE:"wps_office"},fi={[We.TEST]:"https://ovs-shopwindow-server-sg-test.wps.com",[We.PROD]:"https://ovs-shopwindow-server.wps.com"},pi={WINDOW_DATA_INIT:"WINDOW_DATA_INIT"},it=L.create({baseURL:"",timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json"}}),Rr=(it.interceptors.request.use(e=>{var{baseURL:t,data:r,params:s,method:n}=e,s={...s,...r}.env;return t||(e.baseURL=fi[s]),n==="get"?delete e.params.env:delete e.data.env,e},e=>{throw new Error("instance.interceptors.request error: "+e)}),it.interceptors.response.use(e=>{var{status:t,data:r}=e;return t===200?r:Promise.reject(e)},e=>{var t=e.response;return t==null||t.data,Promise.reject(e)}),(e,t={},r={baseURL:"",headers:{}})=>{let{baseURL:n,headers:s}=r;return new Promise((i,o)=>{it({method:"get",url:e,params:t,baseURL:n,headers:s}).then(a=>{i(a)}).catch(a=>{o(a)})})});var _i={fetchWebWindowDataByGroupPage:(e={})=>Rr("/api/v1/shop_window/type/web",e)},mi={fetchWebWindowDataByGroupPage:(e={})=>Rr("/api/v1/shop_window/type/android",e)};let hi={wps_premium:"WPS Pro",new_template_privilege:"WPS Pro",wps_pro:"WPS Pro",wps_ai_premium:"WPS AI"};function Ei({data:e,platform:t,allFields:r}){var n,s,i;return le(e)?({id:e,pay_page_style_content:n,style_content:s,shop_items:i}=e,{window_id:e,window_style:he.WEB===t?n:s,shopList:i.map(({permit_text:o,privilege_code:a,item_content:d,period:c,period_unit:u,item_label_text:p,price_display:h,price_unit:g,avg_price_display:f,currency:E,currency_symbol:_,amount:T,avg_price:I,originShop:y={},...N})=>({privilege_code:a,permit_text:he.WEB===t?o:a.split(",").map(A=>hi[A]).join(" + "),currency:E,currency_symbol:_,period:c,period_unit:u,amount:T,price_unit:g,price:h,avg_price:f,avg_price_with_price_unit:I,underline_price:(y||{}).price_display,underline_avg_price:(y||{}).avg_price_display,underline_avg_price_with_price_unit:(y||{}).avg_price,shop_style:d,item_label_text:p,...r?N:{}}))}):{}}async function gi(e={}){var d;var{env:t,platform:r=he.WEB}=e;if(t&&!qt.includes(t))throw new Error("env must one of "+qt.join(","));if(!$t.includes(r))throw new Error("platform must one of "+$t.join(","));if(!e.group_page||!e.type)throw new Error("fetchWebWindowDataByGroupPage: lang & group_page & type & app_code is required");t={[he.WEB]:_i.fetchWebWindowDataByGroupPage,[he.ANDROID]:mi.fetchWebWindowDataByGroupPage};let n={code:-1,data:{},message:""};try{let{permitTrialList:c,permitTrialCount:u,allFields:p=!1,...h}=e;var s,{code:i,data:o}=await t[r]({lang:"en-US",env:We.PROD,app_code:di.WPS_OFFICE,...h})||{},{list:a=[]}=o||{};Array.isArray(a)&&a.length&&(s=li(pi.WINDOW_DATA_INIT,{windowList:a,shopIndex:0,platform:r,currentSelectPayment:(d=a[0])==null?void 0:d.default_payment,permitTrialList:c||[],permitTrialCount:u||0}),n={...n,code:i,data:Ei({data:s==null?void 0:s.currentWindow,platform:r,allFields:p})})}catch(c){n={code:-1,data:{},message:c.message}}return n}const gt=3e4,Lr=1e3;async function He(e,t,r,n){const s=await j(w.INITIAL_SERVICE),i={...t,...e,initial_service:s,feature:n==="translate"?"plugin_translate_image":"plugin_extract_image",image_count_sum:1,status:"processing"};ce.fireEvent(Yt.OVERSEA_TRANSLATE_STATUS,i,r)}async function x(e,t,r,n){const s=await j(w.INITIAL_SERVICE),i={...t,...e,initial_service:s,feature:n==="translate"?"plugin_translate_image":"plugin_extract_image",image_count_sum:1};ce.fireEvent(Yt.OVERSEA_TRANSLATE_STATUS,i,r)}async function Ti(e){try{const t=await fetch(e,{method:"GET"});if(!t.ok)return{success:!1,error:`HTTP ${t.status}: ${t.statusText}`};const r=await t.blob();if(r.size===0)return{success:!1,error:"Empty image data"};const n=new FileReader,s=new Promise((o,a)=>{n.onload=function(){const d=n.result;o(d)},n.onerror=function(){a(n.error)}});return n.readAsDataURL(r),{success:!0,base64Data:await s,mimeType:r.type||"image/png"}}catch(t){return{success:!1,error:(t==null?void 0:t.message)||"Failed to fetch image"}}}async function Si(e){const t=new Promise((a,d)=>{setTimeout(()=>{d(new Error("timeout"))},gt)}),r=e.type==="translate"?rn:nn;let n="image_pre_upload",s={};const i=Date.now(),o=(async()=>{var ne,Z,$,V,k;const a=await Xt(),c=await(await fetch(e.imageUrl)).blob();let u=e.filename.split(".").pop()||"png";u==="webp"&&(u="jpg");const p=Date.now(),h={request_id:e.requestId,format:u,source_language_target_language:`auto_dect||${e.to}`},g={...h,stage:n};s=g,He(g,e.reportParams,e.userProperties,e.type);const f=await r({...e,fileSize:c.size,ext:u,deviceId:a},e.region),E=f.status,_=f.result;if(E===201)return x({...g,status:"success_pre_upload",duration:Date.now()-p},e.reportParams,e.userProperties,e.type),{code:P.SUCCESS,msg:"success",data:{fileUuid:(ne=_.data)==null?void 0:ne.file_uuid}};const T=(Z=_.data)==null?void 0:Z.file_uuid,I=($=_.data)==null?void 0:$.job_id,y=e.type==="translate"?(V=_.data)==null?void 0:V.upload_url:`/newservice/api/v5/upload/${I}`,N=((k=_.data)==null?void 0:k.header)||{},A=Object.fromEntries(Object.entries(N).map(([se,D])=>[se,D[0]]));if(_.code!==P.SUCCESS||!y||!T&&!I)return x({...g,status:`failed_${_.msg}`,duration:Date.now()-p},e.reportParams,e.userProperties,e.type),U.error("图片翻译任务预上传失败:",_.code,_.msg),{code:_.code,msg:_.msg};x({...g,status:"success_pre_upload",duration:Date.now()-p},e.reportParams,e.userProperties,e.type),n="image_upload";const F=Date.now(),O={...h,stage:n,file_id:T};s=O,He(O,e.reportParams,e.userProperties,e.type);const q=await(e.type==="translate"?sn:on)(y,A,e.requestId,c,e.region);return q.success?(x({...O,status:"success",duration:Date.now()-F},e.reportParams,e.userProperties,e.type),{code:P.SUCCESS,msg:"success",data:{fileUuid:e.type==="translate"?T:q.fileid}}):(x({...O,status:`failed_${q.msg}`,duration:Date.now()-F},e.reportParams,e.userProperties,e.type),{code:500,msg:q.msg})})();try{return await Promise.race([o,t])}catch(a){const d=a&&a.message?a.message:"network_error";return x({...s,stage:n,status:`failed_${d}`,duration:Date.now()-i},e.reportParams,e.userProperties,e.type),(a==null?void 0:a.message)==="timeout"?{code:P.REQUEST_TIMEOUT,msg:"timeout"}:{code:500,msg:d}}}async function yi(e){var s;const t=Date.now(),n={...{request_id:e.requestId,format:e.filename.split(".").pop()||"png",source_language_target_language:`auto_dect||${e.to}`,file_id:e.fileUuid,translate_engine:e.translateEngine,engine_code:e.engineName},stage:"translate"};He(n,e.reportParams,e.userProperties,"translate");try{const i=await an({trans_engine:e.translateEngine,engine_code:e.engineName,file_uuid:e.fileUuid,file_md5:e.md5,to_lang:e.to,requestId:e.requestId},e.isVip,e.region),o=(s=i==null?void 0:i.data)==null?void 0:s.task_id;return i.code!==P.SUCCESS||!o?(U.error("图片翻译任务提交失败:",i.code,i.msg),x({...n,status:`failed_${i.msg}`,duration:Date.now()-t},e.reportParams,e.userProperties,"translate"),{code:i.code,msg:i.msg}):new Promise(a=>{let d=null,c=null,u=!1;const p=(f,E)=>{u||(u=!0,c&&clearTimeout(c),d&&clearTimeout(d),x({...n,status:`${E}`,duration:Date.now()-t},e.reportParams,e.userProperties,"translate"),a({code:f,msg:E}))},h=f=>{u||(u=!0,c&&clearTimeout(c),d&&clearTimeout(d),x({...n,status:"success",duration:Date.now()-t},e.reportParams,e.userProperties,"translate"),a({code:P.SUCCESS,msg:"success",data:f}))};c=setTimeout(()=>{u||(U.error("图片翻译任务超时"),x({...n,status:"failed_timeout",duration:Date.now()-t},e.reportParams,e.userProperties,"translate"),p(P.REQUEST_TIMEOUT,"timeout"))},gt);const g=async()=>{var f,E,_;try{const T=await cn({task_id:o,requestId:e.requestId},e.isVip,e.region),I=(f=T==null?void 0:T.data)==null?void 0:f.status;if(T.code!==0||I===void 0)return U.error("图片翻译任务查询失败:",T.code,T.msg),p(T.code,T.msg||"failed_query_job");if(I===200)return U.error("用户取消翻译"),p(I,"failed_user_cancelled");if(I>200){const y=`failed_${((E=T==null?void 0:T.data)==null?void 0:E.fail_msg)||"unknown_error"}`;return U.error("图片翻译任务失败:",I,y),p(I,y)}if(I===100){const y=(_=T.data)==null?void 0:_.result;return y?h({resultFileUrl:y.result_file_url,originalText:y.origin_text,translatedText:y.trans_text}):p(500,"failed_no_result")}u||(d=setTimeout(g,Lr))}catch(T){const I=`failed_${(T==null?void 0:T.message)||"unknown_error"}`;return U.error("图片翻译任务查询异常:",I),p(500,I)}};g()})}catch(i){const o=i&&i.message?i.message:"network_error";return x({...n,status:`failed_${o}`,duration:Date.now()-t},e.reportParams,e.userProperties,"translate"),{code:500,msg:o}}}async function Ii(e){const t=Date.now(),n={...{request_id:e.requestId,format:e.filename.split(".").pop()||"png",source_language_target_language:`auto_dect||${e.to}`,file_id:e.fileUuid,translate_engine:e.translateEngine,engine_code:e.engineName},stage:"extract"};He(n,e.reportParams,e.userProperties,"ocr");try{const s=await Zr({file_uuid:e.fileUuid,requestId:e.requestId},e.isVip,e.region),i=s==null?void 0:s.jobid;return s.code!==P.SUCCESS||!i?(U.error("图片提取文字任务提交失败:",s.code,s.msg),x({...n,status:`failed_${s.msg}`,duration:Date.now()-t},e.reportParams,e.userProperties,"ocr"),{code:s.code,msg:s.msg}):new Promise(o=>{let a=null,d=null,c=!1;const u=(g,f)=>{c||(c=!0,d&&clearTimeout(d),a&&clearTimeout(a),x({...n,status:`${f}`,duration:Date.now()-t},e.reportParams,e.userProperties,"ocr"),o({code:g,msg:f}))},p=g=>{c||(c=!0,d&&clearTimeout(d),a&&clearTimeout(a),x({...n,status:"success",duration:Date.now()-t},e.reportParams,e.userProperties,"ocr"),o({code:P.SUCCESS,msg:"success",data:g}))};d=setTimeout(()=>{c||(U.error("图片提取文字任务超时"),x({...n,status:"failed_timeout",duration:Date.now()-t},e.reportParams,e.userProperties,"ocr"),u(P.REQUEST_TIMEOUT,"timeout"))},gt);const h=async()=>{try{const g=await en({jobId:i,requestId:e.requestId},e.region),f=g==null?void 0:g.progress;if(g.code!==0||f===void 0)return U.error("图片提取文字任务查询失败:",g.code,g.msg),u(g.code,g.msg||"failed_query_job");if(f===100){const E=g.result;if(!E||E.result_code!==0)return u(500,(E==null?void 0:E.msg)||"failed_no_result");const _=E.result_files&&E.result_files[0];if(!_)return u(500,"failed_no_file_info");const T=await tn({fileId:_.fileid,size:_.size,type:_.type,requestId:e.requestId},e.region);return T.code!==P.SUCCESS?u(500,T.msg||"failed_download"):p({ocrText:T.content||""})}c||(a=setTimeout(h,Lr))}catch(g){const f=`failed_${(g==null?void 0:g.message)||"unknown_error"}`;return U.error("图片提取文字任务查询异常:",f),u(500,f)}};h()})}catch(s){const i=s&&s.message?s.message:"network_error";return x({...n,status:`failed_${i}`,duration:Date.now()-t},e.reportParams,e.userProperties,"ocr"),{code:500,msg:i}}}const ee=new Map,Ye=(e,t,r)=>{let s=!1,i=[];return(...o)=>(a,d=!0)=>{if(i.push(a),s)return!0;if(ee.has(e.name)&&d){U.info(`${e.name} from cache: `,ee.get(e.name)),a(ee.get(e.name));return}return s=!0,e(...o).then(c=>{U.success(`${e.name} from server: `,c),ee.set(e.name,t(c))}).catch(c=>{U.error(`${e.name} server error: `,c),ee.set(e.name,r())}).finally(()=>{i.forEach(c=>c(ee.get(e.name))),i=[],s=!1,setTimeout(()=>{ee.delete(e.name)},5e3)}),!0}},wi=Ye(ft,e=>{if(e.code===P.SUCCESS)return ke(e.data.setting),{code:e.code,data:e.data.setting};if(e.code===P.NO_SETTING)return{code:e.code}},()=>{}),Ni=Ye(dt,e=>{if(e.result==="ok")return e},()=>{}),Ai=Ye(Kt,e=>{var t,r;return e.code===P.SUCCESS?{isVip:!!((r=(t=e.data)==null?void 0:t.func_list)==null?void 0:r.some(s=>s.includes(J.permitTag)))}:{isVip:!1}},()=>({isVip:!1})),Oi=Ye(un,e=>e,()=>{}),bi=e=>{ee.delete(e)};async function Ri(){if(await j(w.TEMP_CONFIGS))try{const t=await dt();let r;const n=s=>{ie(m.NOTIFY_CONTENT_SETTING_CHANGE,s),ke(s),ln(w.TEMP_CONFIGS)};if(t.result==="ok"){const s=await ft();s.code===P.SUCCESS&&(r=await Tt(s.data.setting),await B(`${t.userid}-${w.CONFIGS}`,r,Qt),await Zt(r),n(r))}else{const s=await j(w.CONFIGS,te);r=await Tt(s),await B(w.CONFIGS,r),n(r)}}catch{}}const Li=1e4,Ci=100;async function Pi(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}async function Cr(){const e=await dn();if(!(!e||e.protocol!=="https:"))return Pi(`${e.host}${e.pathname}`)}async function Ui(e,t){const r=await j(w.SITE_SOURCE_LANGUAGE,{}),n=await Cr();if(n){if(r[n])t?delete r[n]:r[n]=e;else{const s=Object.keys(r);s.length>=Li&&s.splice(0,Ci).forEach(i=>{delete r[i]}),r[n]=e}await B(w.SITE_SOURCE_LANGUAGE,r)}}async function xi(){const e=await j(w.SITE_SOURCE_LANGUAGE,{}),t=await Cr();return t&&e[t]||""}const _e=new Map,Mi={[m.SCREEN_SHOT]:(e,t,r)=>{var s;const n=(s=t.tab)==null?void 0:s.windowId;if(n)return chrome.tabs.captureVisibleTab(n,{format:"png"},i=>{const o=performance.now();if(chrome.runtime.lastError){r({result:Nt.FAIL,data:`${chrome.runtime.lastError}`,time:o});return}r({result:Nt.SUCCESS,data:i,time:o})}),!0},[m.GET_USER_SETTINGS]:(e,t,r)=>(wi()(r,!xe(t.url)),!0),[m.CHANGE_USER_SETTINGS]:(e,t,r)=>(Zt(e).then(n=>{n.code===P.SUCCESS?r(!0):r(!1)}).catch(()=>{r(!1)}).finally(()=>{bi("getUserConfig")}),!0),[m.NOTIFY_EXTENSION_SETTING_CHANGE]:(e,t)=>{var n;ke(e);const r=(n=t.tab)!=null&&n.id?[t.tab.id]:[];ie(m.NOTIFY_CONTENT_SETTING_CHANGE,e,r)},[m.NOTIFY_IFRAME_SETTING_CHANGE]:(e,t)=>{var n;const r=(n=t.tab)==null?void 0:n.id;r&&b(r,m.NOTIFY_IFRAME_SETTING_CHANGE,e)},[m.SET_OTHER_TABS_TRANSLATE_PAGE_STYLE]:(e,t)=>{var n;const r=(n=t.tab)!=null&&n.id?[t.tab.id]:[];ie(m.SET_TRANSLATE_PAGE_STYLE,e,r)},[m.NOTIFY_NO_LOGIN_LOCALE_CHANGE]:(e,t)=>{var n;const r=(n=t.tab)!=null&&n.id?[t.tab.id]:[];ie(m.NOTIFY_NO_LOGIN_LOCALE_CHANGE,e,r)},[m.STORE_WEB_SOURCE_LANGUAGE]:e=>{Ui(e.language,e.isAuto)},[m.GET_WEB_SOURCE_LANGUAGE]:(e,t,r)=>(xi().then(n=>{r(n)}),!0),[m.GET_USER_INFO]:(e,t,r)=>(Ni()(r,!xe(t.url)),!0),[m.GET_USER_PERMIT_INFO]:(e,t,r)=>(Ai(e)(r,!xe(t.url)),!0),[m.DETECT_PAGE_LANGUAGE]:(e,t,r)=>(It().then(n=>{const s=wn.find(i=>i.value===n);r(s?n:J.defaultSourceLanguage)}).catch(()=>{r(J.defaultSourceLanguage)}),!0),[m.DETECT_TEXT_LANGUAGE]:(e,t,r)=>(In(e).then(n=>{const s=Jt(n);r(s?s.value:J.defaultSourceLanguage)}).catch(()=>{r(J.defaultSourceLanguage)}),!0),[m.OPEN_POPUP]:()=>{chrome.action.openPopup()},[m.NOTIFY_EXTENSION_LOGIN_STATE]:(e,t)=>{var n;const r=(n=t.tab)!=null&&n.id?[t.tab.id]:void 0;ie(m.NOTIFY_CONTENT_LOGIN_STATE,e,r)},[m.TRANSLATE_TEXT]:(e,t,r)=>(On(e).then(n=>{r(n)}).catch(n=>{r({code:500,msg:n&&n.message?n.message:"network_error"})}),!0),[m.CHAT_COMPLETIONS]:(e,t)=>{var n;const r=(n=t.tab)==null?void 0:n.id;if(r){let s=wt[we.EXPLAIN];e.translateType===we.IMPROVE_WRITE&&(s=wt[we.IMPROVE_WRITE]),yn(e.input,e.engineCode,e.targetLanguage,async(i,o)=>{const a=e.translateType,d=e.requestId;if(i)if(o&&typeof o=="object")try{await b(r,m.CHAT_COMPLETIONS_RESPONSE,{done:i,response:o,requestId:d,translateType:a,reportParams:e.reportParams})}catch{}else await b(r,m.CHAT_COMPLETIONS_RESPONSE,{done:i,requestId:d,translateType:a,reportParams:e.reportParams});else{let c="";typeof o=="string"&&(c=o);try{await b(r,m.CHAT_COMPLETIONS_RESPONSE,{done:i,result:c,requestId:d,translateType:a,reportParams:e.reportParams})}catch{}return}},e.scene,e.component,s,e.requestId,e.styles)}},[m.CHANGE_CONTEXT_MENU_BY_SETTING]:e=>{ke(e)},[m.CHANGE_CONTEXT_MENU_BY_TRANSLATE_STATUS]:e=>{pt(e)},[m.GET_POPUP_PERFORMANCE_NOW]:(e,t,r)=>{r(performance.now())},[m.GET_ONLINE_PARAMS]:(e,t,r)=>(Oi()(r,!xe(t.url)),!0),[m.CLOSE_HOVER_BALL_ONBOARDING]:(e,t)=>{var n;const r=(n=t.tab)!=null&&n.id?[t.tab.id]:void 0;ie(m.CLOSE_HOVER_BALL_ONBOARDING,void 0,r)},[m.GET_DEVICE_ID]:(e,t,r)=>(Xt().then(n=>{r(n)}),!0),[m.FIRE_EVENT]:e=>{ce.fireEvent(e.eventName,e.params,e.userProperties)},[m.GET_COOKIE_LANGUAGE]:(e,t,r)=>(er().then(n=>{r(n)}),!0),[m.GET_TAB_INFO]:(e,t,r)=>(chrome.windows.getCurrent(n=>{var i;const s=(i=t.tab)==null?void 0:i.windowId;r({windowId:s,isWindowActive:s===n.id})}),!0),[m.UPDATE_CONTEXT_MENU_BY_TARGET_LANGUAGE]:e=>{Rn(e)},[m.DETECT_SYSTEM_LANGUAGE]:(e,t,r)=>{r(chrome.i18n.getUILanguage())},[m.OPEN_NEW_PAGE]:(e,t,r)=>(chrome.tabs.create({url:e.url},()=>{chrome.runtime.lastError?r(!1):r(!0)}),!0),[m.GET_PDF_FILE_CONTENT]:(e,t)=>{var n;const r=(n=t.tab)==null?void 0:n.id;r&&fetch(e.url).then(async s=>{const i=await s.arrayBuffer(),o=Math.ceil(i.byteLength/tt);if(i.byteLength>gn){await b(r,m.PDF_FILE_GET_ERROR,{errorType:"overSize",fileName:e.url});return}for(let d=0;d<o;d++){if(!await Tn(r))return;const u=d*tt,p=Math.min(u+tt,i.byteLength),h=i.slice(u,p),g=new Uint8Array(h);await b(r,m.PDF_FILE_CHUNK,{data:Array.from(g),chunkIndex:d,totalChunks:o,fileName:e.url}),await Sn(10)}await b(r,m.PDF_FILE_CHUNK_DONE,{fileName:e.url})}).catch(s=>{b(r,m.PDF_FILE_GET_ERROR,{errorType:"unknown",fileName:e.url})})},[m.GET_LOGIN_URL]:(e,t,r)=>{const n=`${m.GET_LOGIN_URL}`,s="com.wps.anydocextension",i={action:"get_redirect_url",params:{url:"https://www.wps.com/"}};if(!_e.get(n))return _e.set(n,!0),yt(s,i).then(o=>{var a,d,c;((a=o==null?void 0:o.response)==null?void 0:a.code)===200?r({code:200,url:et(o.response.redirect_url)}):r({code:(d=o==null?void 0:o.response)==null?void 0:d.code,errorMsg:et((c=o==null?void 0:o.response)==null?void 0:c.error_msg)})}).catch(o=>{r({code:-100,errorMsg:(o==null?void 0:o.message)||"unknown"})}).finally(()=>{_e.delete(n)}),!0},[m.GET_PAGE_LANGUAGE]:(e,t,r)=>(It().then(n=>{r(n)}).catch(()=>{r(void 0)}),!0),[m.CONTENT_SCRIPT_TRANSLATE_PAGE]:(e,t)=>{var n,s;const r=(n=t.tab)==null?void 0:n.id;if(r)if(e.translate){if(Vt(((s=t.tab)==null?void 0:s.url)||"")){b(r,m.TRANSLATE_GOOGLE_DOCS_PAGE,{scene:e.scene});return}b(r,m.TRANSLATE_PAGE,{scene:e.scene})}else b(r,m.SHOW_ORIGIN,{scene:e.scene})},[m.CONTENT_SCRIPT_CHANGE_TRANSLATE_OPTIONS]:(e,t)=>{var n;const r=(n=t.tab)==null?void 0:n.id;r&&b(r,m.CHANGE_TRANSLATE_OPTIONS,e)},[m.SET_IFRAME_TRANSLATE_PAGE_STYLE]:(e,t)=>{var n;const r=(n=t.tab)==null?void 0:n.id;r&&b(r,m.SET_TRANSLATE_PAGE_STYLE,e)},[m.GET_WPS_CLIENT_INFO]:(e,t,r)=>{const n=`${m.GET_WPS_CLIENT_INFO}`,s="com.wps.anydocextension",i={action:"get_info",params:{from:e.from}};if(!_e.get(n))return _e.set(n,!0),yt(s,i).then(o=>{var a,d,c,u,p,h;((a=o==null?void 0:o.response)==null?void 0:a.code)===200?r({code:200,data:{deviceId:(d=o==null?void 0:o.response)==null?void 0:d.device_id,exe_version:(c=o==null?void 0:o.response)==null?void 0:c.exe_version,host_version:(u=o==null?void 0:o.response)==null?void 0:u.host_version}}):r({code:(p=o==null?void 0:o.response)==null?void 0:p.code,errorMsg:et(((h=o==null?void 0:o.response)==null?void 0:h.error_msg)||"")})}).catch(o=>{r({code:-100,errorMsg:(o==null?void 0:o.message)||"unknown"})}).finally(()=>{_e.delete(n)}),!0},[m.GET_IMAGE_TRANSLATE_COUNT]:(e,t,r)=>{const{userInfo:n,type:s}=e,i=s==="translate"?St[we.IMAGE]:St[we.IMAGE_OCR];return n.isVip?hn(i).then(o=>{var c;const d=(((c=o.data)==null?void 0:c.summary)||[]).find(u=>u.component===i);r(d==null?void 0:d.available_count)}).catch(()=>{r(void 0)}):En(i).then(o=>{var c;const d=(((c=o.data)==null?void 0:c.benefits)||{})[i];r(d==null?void 0:d.count)}).catch(()=>{r(void 0)}),!0},[m.TRANSLATE_IMAGE_REQUEST]:(e,t,r)=>(yi(e).then(n=>{r(n)}).catch(n=>{r({code:500,msg:n&&n.message?n.message:"network_error"})}),!0),[m.UPLOAD_IMAGE_REQUEST]:(e,t,r)=>(Si(e).then(n=>{r(n)}).catch(n=>{r({code:500,msg:n&&n.message?n.message:"network_error"})}),!0),[m.GET_WEB_IMAGE_CONTENT]:(e,t,r)=>(Ti(e.imageUrl).then(n=>{r(n)}),!0),[m.GET_GEO_INFO]:(e,t,r)=>(j(w.GEO_INFO).then(n=>{n?r(n):mn().then(s=>{s?(B(w.GEO_INFO,s),r(s)):r({})})}).catch(()=>{r({})}),!0),[m.IMAGE_OCR_REQUEST]:(e,t,r)=>(Ii(e).then(n=>{r(n)}).catch(n=>{r({code:500,msg:n&&n.message?n.message:"network_error"})}),!0),[m.CONSUME_PERMITS]:(e,t,r)=>(e.isVip?pn(e.component,e.count,e.requestId).then(n=>{r(n)}).catch(n=>{r({code:500,msg:n&&n.message?n.message:"network_error"})}):_n(e.component,e.count).then(n=>{r(n)}).catch(n=>{r({code:500,msg:n&&n.message?n.message:"network_error"})}),!0),[m.GET_SKU_INFO]:(e,t,r)=>(fn({app_code:"wps_office",platform:"web",try_type:"permit"}).then(n=>{var s,i;if(!n||n.code!==0)r(void 0);else{const o=(i=(s=n.data)==null?void 0:s.try_info)==null?void 0:i.map(d=>d.permit_name),a={env:"production",lang:e.locale,group_page:"anydoc_translator_pro",type:"web_official",platform:"web",permitTrialList:o,allFields:!0};gi(a).then(d=>{d.code===0?r(d.data):r(void 0)}).catch(()=>{r(void 0)})}}),!0)};function Fi(e){e.onDisconnect.addListener(()=>{Ri()})}function Di(e){e.onDisconnect.addListener(()=>{})}function Gi(){chrome.runtime.onConnect.addListener(e=>{switch(e.name){case At.POP_UP:Fi(e);break;case At.INJECTION:Di(e);break}}),chrome.runtime.onMessage.addListener((e,t,r)=>{const n=Mi[e.type];if(n)return n(e.data,t,r)}),chrome.runtime.onMessageExternal.addListener((e,t,r)=>{e.action==="ping"&&r({pong:!0})}),chrome.windows.onFocusChanged.addListener(e=>{ie(m.CURRENT_ACTIVE_WINDOW,e)})}function vi(){return(chrome.runtime.getManifest().content_scripts||[]).flatMap(n=>n.js)}function ki(){Nn().then(e=>{e.forEach(t=>{var r;if(!(!t||!t.id||!((r=t.url)!=null&&r.startsWith("http"))))try{chrome.scripting.executeScript({target:{tabId:t.id},files:vi(),injectImmediately:!0})}catch{}})})}async function Bi(){const e=await j(w.ON_BOARDING_TIME),t=await j(w.INSTALL_SOURCE),r=await An(J.mainPage);e||(chrome.tabs.create({url:`${r}?utm_source=${t}&source=web_plugin_activate_guide`}),B(w.ON_BOARDING_TIME,Date.now()))}async function Wi(){var t,r,n,s;const e={};try{const i=await dt(),o=await er();if(o&&(te.interfaceLanguage=lt(o).value),i.result==="ok"){const d=(r=(t=(await Kt({uid:i.userid})).data)==null?void 0:t.func_list)==null?void 0:r.some(u=>u.includes(J.permitTag));i.isVip=d,e.userInfo=i,B(w.USER_INFO,e.userInfo);const c=await ft();c.code===P.SUCCESS?(e.userConfig=c.data.setting,B(`${(n=e.userInfo)==null?void 0:n.userid}-${w.CONFIGS}`,e.userConfig,Qt)):e.userConfig=await j(`${(s=e.userInfo)==null?void 0:s.userid}-${w.CONFIGS}`,te)}else e.userInfo=void 0,e.userConfig=await j(w.CONFIGS,te),e.userConfig.interfaceLanguage=te.interfaceLanguage}catch{e.userInfo=void 0,e.userConfig=await j(w.CONFIGS,te)}return e}async function Hi(){try{const e=await chrome.cookies.get({url:`https://${J.webHost}`,name:"downloadPluginSource"});return(e==null?void 0:e.value)||""}catch(e){return ce.fireErrorEvent({type:"getInstallSourceError",message:e instanceof Error?e.message:String(e)}),""}}async function ji(e){const t=await Hi();if(t){await B(w.INSTALL_SOURCE,t);return}switch(e.reason){case"install":await B(w.INSTALL_SOURCE,"plugin_install");break;case"update":await B(w.INSTALL_SOURCE,"plugin_update");break;case"chrome_update":await B(w.INSTALL_SOURCE,"plugin_chrome_update");break;default:await B(w.INSTALL_SOURCE,"plugin_other")}}async function qi(e){var t,r,n,s;ce.setReportUserProperties({is_member:(t=e.userInfo)!=null&&t.isVip?1:0,is_login:e.userInfo?1:0,userid:String(((r=e.userInfo)==null?void 0:r.userid)||"0"),account_type:(s=(n=e.userInfo)==null?void 0:n.email)!=null&&s.endsWith("@gmail.com")?"google":"email"}),ce.fireEvent("oversea_plugin_installed",{interface_language:e.userConfig.interfaceLanguage})}async function $i(){chrome.runtime.onInstalled.addListener(async e=>{ki();let t=te;try{await ji(e),await ce.init();const r=await Wi();qi(r),t=r.userConfig,await B(w.INTERFACE_LOCALE,t.interfaceLanguage)}catch{}finally{Bi(),bn(t)}}),Gi(),chrome.runtime.setUninstallURL(J.uninstallPage)}$i();
